<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë§ì¶¤ ì§€ì›ê¸ˆ ì°¾ê¸°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563EB; --primary-light: #3B82F6; --primary-dark: #1D4ED8;
            --primary-50: #EFF6FF; --primary-100: #DBEAFE;
            --gray-900: #111827; --gray-800: #1F2937; --gray-700: #374151;
            --gray-600: #4B5563; --gray-500: #6B7280; --gray-400: #9CA3AF;
            --gray-300: #D1D5DB; --gray-200: #E5E7EB; --gray-100: #F3F4F6;
            --gray-50: #F9FAFB; --white: #FFFFFF;
            --gradient-primary: linear-gradient(135deg, #2563EB 0%, #7C3AED 100%);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --radius-sm: 8px; --radius: 12px; --radius-lg: 16px;
            --radius-xl: 24px; --radius-full: 9999px;
            --font-family: 'Noto Sans KR', -apple-system, sans-serif;
            --transition: 0.2s ease;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html, body { height: 100%; font-family: var(--font-family); background: var(--gray-50); }
        button, input, select { font-family: inherit; }
        button { cursor: pointer; }

        .chatbot-wrapper { min-height: 100vh; min-height: 100dvh; display: flex; align-items: flex-start; justify-content: center; padding: 16px; }
        .chatbot-container { width: 100%; max-width: 480px; background: var(--white); border-radius: var(--radius-xl); box-shadow: var(--shadow-xl); overflow: hidden; display: flex; flex-direction: column; max-height: calc(100dvh - 32px); }
        
        .chatbot-header { display: flex; align-items: center; gap: 16px; padding: 20px; background: var(--gradient-primary); color: var(--white); }
        .header-icon { width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; }
        .header-icon svg { width: 28px; height: 28px; }
        .header-text { flex: 1; }
        .header-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 4px; }
        .header-subtitle { font-size: 0.813rem; opacity: 0.9; }
        .reset-btn { width: 40px; height: 40px; background: rgba(255,255,255,0.15); border: none; border-radius: var(--radius-sm); color: var(--white); display: flex; align-items: center; justify-content: center; transition: var(--transition); }
        .reset-btn:hover { background: rgba(255,255,255,0.25); }
        .reset-btn svg { width: 20px; height: 20px; }

        .progress-wrap { padding: 12px 20px; background: var(--gray-50); border-bottom: 1px solid var(--gray-100); display: flex; align-items: center; gap: 12px; }
        .progress-bar { flex: 1; height: 6px; background: var(--gray-200); border-radius: var(--radius-full); overflow: hidden; }
        .progress-fill { height: 100%; background: var(--gradient-primary); transition: width 0.4s ease; width: 0%; }
        .progress-text { font-size: 0.75rem; font-weight: 600; color: var(--gray-500); }

        .messages-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 16px; min-height: 320px; }
        .message { display: flex; gap: 8px; max-width: 90%; animation: msgFadeIn 0.3s ease; }
        @keyframes msgFadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.bot { align-self: flex-start; }
        .message-avatar { width: 36px; height: 36px; background: var(--gradient-primary); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .message-avatar svg { width: 20px; height: 20px; color: var(--white); }
        .message-bubble { padding: 14px 16px; border-radius: var(--radius); font-size: 0.938rem; line-height: 1.6; }
        .message.bot .message-bubble { background: var(--gray-100); color: var(--gray-800); border-top-left-radius: 4px; }
        .message.user { align-self: flex-end; flex-direction: row-reverse; }
        .message.user .message-bubble { background: var(--gradient-primary); color: var(--white); border-top-right-radius: 4px; }

        .typing-dots { display: flex; gap: 4px; padding: 14px 16px; }
        .typing-dots span { width: 8px; height: 8px; background: var(--gray-400); border-radius: 50%; animation: bounce 1.4s infinite; }
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-8px); } }

        .input-area { padding: 16px 20px 20px; background: var(--white); border-top: 1px solid var(--gray-100); }
        .options-grid { display: flex; flex-direction: column; gap: 8px; }
        .options-grid.cols-2 { display: grid; grid-template-columns: repeat(2, 1fr); }

        .option-btn { background: var(--white); border: 2px solid var(--gray-200); border-radius: var(--radius); padding: 14px 16px; font-size: 0.938rem; font-weight: 500; color: var(--gray-700); transition: var(--transition); text-align: center; }
        .option-btn:hover { border-color: var(--primary); background: var(--primary-50); color: var(--primary); }
        .option-btn.selected { border-color: var(--primary); background: var(--primary); color: var(--white); }
        .option-btn .sub-text { display: block; font-size: 0.75rem; opacity: 0.8; margin-top: 4px; }

        .option-btn.multi { position: relative; padding-left: 44px; text-align: left; }
        .option-btn.multi::before { content: ''; position: absolute; left: 14px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; border: 2px solid var(--gray-300); border-radius: 4px; }
        .option-btn.multi.selected::before { background: var(--primary); border-color: var(--primary); }
        .option-btn.multi.selected::after { content: ''; position: absolute; left: 19px; top: 50%; transform: translateY(-60%) rotate(45deg); width: 5px; height: 10px; border: solid var(--white); border-width: 0 2px 2px 0; }

        .confirm-btn { width: 100%; background: var(--gradient-primary); border: none; border-radius: var(--radius); padding: 14px; font-size: 1rem; font-weight: 600; color: var(--white); margin-top: 8px; transition: var(--transition); }
        .confirm-btn:hover { opacity: 0.9; }
        .confirm-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .select-wrap { display: flex; flex-direction: column; gap: 8px; }
        .custom-select { width: 100%; padding: 14px 40px 14px 16px; border: 2px solid var(--gray-200); border-radius: var(--radius); font-size: 0.938rem; color: var(--gray-700); background: var(--white) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='none' stroke='%236B7280' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E") no-repeat right 12px center; background-size: 20px; appearance: none; }
        .custom-select:focus { outline: none; border-color: var(--primary); }

        .birth-wrap { display: flex; flex-direction: column; gap: 16px; }
        .birth-section { display: flex; flex-direction: column; gap: 8px; }
        .birth-label { font-size: 0.875rem; font-weight: 600; color: var(--gray-700); }
        .birth-row { display: flex; gap: 8px; align-items: center; }
        .birth-input-wrap { flex: 1; }
        .birth-input-wrap.year { flex: 1.5; }
        .birth-input { width: 100%; padding: 14px 12px; border: 2px solid var(--gray-200); border-radius: var(--radius); font-size: 1rem; text-align: center; -moz-appearance: textfield; }
        .birth-input::-webkit-outer-spin-button, .birth-input::-webkit-inner-spin-button { -webkit-appearance: none; }
        .birth-input:focus { outline: none; border-color: var(--primary); }
        .birth-input::placeholder { color: var(--gray-400); font-size: 0.875rem; }
        .birth-suffix { font-size: 0.875rem; color: var(--gray-500); width: 20px; }
        .gender-btns { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }

        .result-modal { position: fixed; inset: 0; z-index: 1000; display: flex; align-items: flex-end; justify-content: center; opacity: 0; visibility: hidden; transition: var(--transition); }
        .result-modal.active { opacity: 1; visibility: visible; }
        .modal-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
        .modal-content { position: relative; width: 100%; max-width: 500px; max-height: 85vh; background: var(--white); border-radius: var(--radius-xl) var(--radius-xl) 0 0; transform: translateY(100%); transition: transform 0.3s ease; display: flex; flex-direction: column; }
        .result-modal.active .modal-content { transform: translateY(0); }
        .modal-header { display: flex; align-items: center; justify-content: space-between; padding: 20px; border-bottom: 1px solid var(--gray-100); }
        .modal-header h3 { font-size: 1.25rem; font-weight: 700; }
        .close-btn { width: 36px; height: 36px; background: var(--gray-100); border: none; border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; }
        .close-btn:hover { background: var(--gray-200); }
        .close-btn svg { width: 20px; height: 20px; color: var(--gray-600); }
        .modal-body { flex: 1; overflow-y: auto; padding: 20px; }

        .result-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; }
        .stat-card { background: var(--gray-50); border-radius: var(--radius); padding: 16px; text-align: center; }
        .stat-card.highlight { background: var(--primary-50); }
        .stat-number { font-size: 1.75rem; font-weight: 700; color: var(--primary); margin-bottom: 4px; }
        .stat-label { font-size: 0.813rem; color: var(--gray-600); }

        .result-list { display: flex; flex-direction: column; gap: 12px; }
        .result-card { background: var(--white); border: 1px solid var(--gray-200); border-radius: var(--radius); padding: 16px; position: relative; }
        .result-card:hover { border-color: var(--primary-100); box-shadow: var(--shadow-md); }
        .result-card.recommended { border-color: #F59E0B; background: linear-gradient(135deg, #FFFBEB 0%, #FEF3C7 100%); }
        .result-card.recommended::before { content: 'â­ ì¶”ì²œ'; position: absolute; top: -8px; right: 12px; background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); color: white; font-size: 0.688rem; font-weight: 700; padding: 4px 10px; border-radius: var(--radius-full); }
        .result-badge { background: var(--primary); color: var(--white); font-size: 0.688rem; font-weight: 600; padding: 4px 8px; border-radius: var(--radius-sm); display: inline-block; margin-bottom: 8px; }
        .result-title { font-size: 1rem; font-weight: 600; color: var(--gray-900); line-height: 1.4; margin-bottom: 8px; }
        .result-org { font-size: 0.813rem; color: var(--gray-500); margin-bottom: 8px; }
        .result-desc { font-size: 0.875rem; color: var(--gray-600); line-height: 1.5; margin-bottom: 12px; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .result-link { display: inline-flex; align-items: center; gap: 4px; font-size: 0.875rem; font-weight: 600; color: var(--primary); text-decoration: none; }
        .result-link:hover { text-decoration: underline; }
        .result-link svg { width: 16px; height: 16px; }

        .no-result { text-align: center; padding: 48px 20px; }
        .no-result-icon { font-size: 3rem; margin-bottom: 16px; }
        .no-result-title { font-size: 1.125rem; font-weight: 600; margin-bottom: 8px; }
        .no-result-desc { font-size: 0.875rem; color: var(--gray-500); }

        .pagination { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--gray-100); }
        .page-btn { width: 40px; height: 40px; border: 2px solid var(--gray-200); border-radius: var(--radius-sm); background: var(--white); color: var(--gray-600); font-size: 0.875rem; font-weight: 600; display: flex; align-items: center; justify-content: center; }
        .page-btn:hover:not(:disabled) { border-color: var(--primary); color: var(--primary); }
        .page-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .page-btn.active { background: var(--primary); border-color: var(--primary); color: var(--white); }
        .page-btn svg { width: 18px; height: 18px; }
        .page-numbers { display: flex; gap: 4px; }

        .error-msg { background: #FEF2F2; border: 1px solid #FECACA; border-radius: var(--radius); padding: 16px; margin-bottom: 16px; }
        .error-msg-title { font-weight: 600; color: #DC2626; margin-bottom: 4px; }
        .error-msg-text { font-size: 0.875rem; color: #991B1B; }

        @media (max-width: 520px) {
            .chatbot-wrapper { padding: 0; }
            .chatbot-container { max-width: 100%; border-radius: 0; max-height: 100dvh; }
            .chatbot-header { padding: 16px; padding-top: max(16px, env(safe-area-inset-top)); }
            .modal-content { max-width: 100%; max-height: 90vh; }
            .page-btn { width: 36px; height: 36px; }
        }
        @media (min-width: 521px) {
            .chatbot-wrapper { align-items: center; padding: 24px; }
            .result-modal { align-items: center; }
            .modal-content { border-radius: var(--radius-xl); max-height: 80vh; }
        }
    </style>
</head>
<body>
    <div class="chatbot-wrapper">
        <div class="chatbot-container">
            <header class="chatbot-header">
                <div class="header-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg></div>
                <div class="header-text">
                    <h1 class="header-title">ë§ì¶¤ ì§€ì›ê¸ˆ ì°¾ê¸°</h1>
                    <p class="header-subtitle">ëª‡ ê°€ì§€ ì§ˆë¬¸ì— ë‹µí•˜ë©´ ë°›ì„ ìˆ˜ ìˆëŠ” ì§€ì›ê¸ˆì„ ì°¾ì•„ë“œë ¤ìš”</p>
                </div>
                <button class="reset-btn" id="resetBtn" title="ì²˜ìŒë¶€í„° ë‹¤ì‹œ"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg></button>
            </header>
            <div class="progress-wrap">
                <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                <span class="progress-text" id="progressText">ì‹œì‘í•˜ê¸°</span>
            </div>
            <main class="messages-area" id="messagesArea"></main>
            <div class="input-area" id="inputArea"></div>
        </div>
    </div>
    <div class="result-modal" id="resultModal">
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ‰ ë§ì¶¤ ì§€ì›ê¸ˆ ê²€ìƒ‰ ì™„ë£Œ!</h3>
                <button class="close-btn" id="closeBtn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
    (function() {
        'use strict';
        
        const CONFIG = {
            API_PROXY_URL: 'https://subsidy-api-proxy.peopleidentityc.workers.dev',
            DEMO_MODE: false,
            ITEMS_PER_PAGE: 20
        };

        const Chatbot = {
            state: { step: 0, answers: {}, currentPage: 1, allServices: [], totalCount: 0 },
            elements: {},

            questions: [
                { id: 'intro', type: 'single', message: 'ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹\në§ì¶¤ ì§€ì›ê¸ˆì„ ì°¾ì•„ë“œë¦´ê²Œìš”.\n\nì–´ë–¤ ìœ í˜•ìœ¼ë¡œ ê²€ìƒ‰í•˜ì‹œê² ì–´ìš”?', options: [{ value: 'personal', label: 'ğŸ‘¤ ê°œì¸/ê°€êµ¬' }, { value: 'business', label: 'ğŸª ì†Œìƒê³µì¸' }, { value: 'corp', label: 'ğŸ¢ ë²•ì¸/ê¸°ê´€' }] },
                { id: 'region', type: 'region', condition: { intro: 'personal' }, message: 'ê±°ì£¼í•˜ì‹œëŠ” ì§€ì—­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', progressText: '1/5 ë‹¨ê³„' },
                { id: 'birthGender', type: 'birthGender', condition: { intro: 'personal' }, message: 'ìƒë…„ì›”ì¼ê³¼ ì„±ë³„ì„ ì•Œë ¤ì£¼ì„¸ìš”.', progressText: '2/5 ë‹¨ê³„' },
                { id: 'income', type: 'single', condition: { intro: 'personal' }, message: 'ê°€êµ¬ì˜ ì†Œë“ ìˆ˜ì¤€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.\n\nğŸ’¡ 2025ë…„ ê¸°ì¤€ì¤‘ìœ„ì†Œë“ (4ì¸ê°€êµ¬: ì›” 572ë§Œì›)', options: [{ value: '0~50', label: '50% ì´í•˜', sub: 'ì›” 286ë§Œì› ì´í•˜' }, { value: '51~75', label: '51~75%', sub: 'ì›” 286~429ë§Œì›' }, { value: '76~100', label: '76~100%', sub: 'ì›” 429~572ë§Œì›' }, { value: '101~200', label: '101~200%', sub: 'ì›” 572~1,145ë§Œì›' }, { value: '200~', label: '200% ì´ˆê³¼', sub: 'ì›” 1,145ë§Œì› ì´ˆê³¼' }], gridClass: 'cols-2', progressText: '3/5 ë‹¨ê³„' },
                { id: 'personalChar', type: 'multi', condition: { intro: 'personal' }, message: 'í•´ë‹¹ë˜ëŠ” ê°œì¸ íŠ¹ì„±ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.', options: [{ value: 'JA0101', label: 'ì˜ˆë¹„ë¶€ë¶€/ë‚œì„' }, { value: 'JA0102', label: 'ì„ì‹ ë¶€' }, { value: 'JA0103', label: 'ì¶œì‚°/ì…ì–‘' }, { value: 'JA0201', label: 'ì˜ìœ ì•„' }, { value: 'JA0301', label: 'ì¥ì• ì¸' }, { value: 'JA0302', label: 'êµ­ê°€ë³´í›ˆëŒ€ìƒì' }, { value: 'JA0401', label: 'ë†ì—…ì¸' }, { value: 'JA0501', label: 'ì¤‘/ê³ ë“±í•™ìƒ' }, { value: 'JA0502', label: 'ëŒ€í•™ìƒ' }, { value: 'JA0601', label: 'ê·¼ë¡œì/ì§ì¥ì¸' }, { value: 'JA0602', label: 'êµ¬ì§ì/ì‹¤ì—…ì' }, { value: 'JA9999', label: 'í•´ë‹¹ì—†ìŒ' }], gridClass: 'cols-2', progressText: '4/5 ë‹¨ê³„' },
                { id: 'familyChar', type: 'multi', condition: { intro: 'personal' }, message: 'í•´ë‹¹ë˜ëŠ” ê°€êµ¬ íŠ¹ì„±ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.', options: [{ value: 'JA0701', label: 'ë‹¤ë¬¸í™”ê°€ì •' }, { value: 'JA0702', label: 'ë¶í•œì´íƒˆì£¼ë¯¼' }, { value: 'JA0703', label: 'í•œë¶€ëª¨/ì¡°ì†ê°€ì •' }, { value: 'JA0704', label: '1ì¸ ê°€êµ¬' }, { value: 'JA0705', label: 'ë‹¤ìë…€ ê°€êµ¬' }, { value: 'JA0706', label: 'ë¬´ì£¼íƒ ì„¸ëŒ€' }, { value: 'JA9999', label: 'í•´ë‹¹ì—†ìŒ' }], gridClass: 'cols-2', progressText: '5/5 ë‹¨ê³„' },
                { id: 'bizRegion', type: 'region', condition: { intro: 'business' }, message: 'ì‚¬ì—…ì¥ ì†Œì¬ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', progressText: '1/2 ë‹¨ê³„' },
                { id: 'bizType', type: 'single', condition: { intro: 'business' }, message: 'ì—…ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', options: [{ value: 'food', label: 'ğŸ½ï¸ ìŒì‹ì ì—…' }, { value: 'manufacture', label: 'ğŸ­ ì œì¡°ì—…' }, { value: 'retail', label: 'ğŸ›’ ë„ì†Œë§¤ì—…' }, { value: 'service', label: 'ğŸ’¼ ì„œë¹„ìŠ¤ì—…' }, { value: 'other', label: 'ğŸ“¦ ê¸°íƒ€' }], gridClass: 'cols-2', progressText: '2/2 ë‹¨ê³„' },
                { id: 'corpRegion', type: 'region', condition: { intro: 'corp' }, message: 'ì‚¬ì—…ì¥ ì†Œì¬ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', progressText: '1/2 ë‹¨ê³„' },
                { id: 'corpBizType', type: 'single', condition: { intro: 'corp' }, message: 'ì—…ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', options: [{ value: 'manufacture', label: 'ğŸ­ ì œì¡°ì—…' }, { value: 'agri', label: 'ğŸŒ¾ ë†ë¦¼ì–´ì—…' }, { value: 'it', label: 'ğŸ’» ì •ë³´í†µì‹ ì—…' }, { value: 'other', label: 'ğŸ“¦ ê¸°íƒ€' }], gridClass: 'cols-2', progressText: '2/2 ë‹¨ê³„' }
            ],

            regions: {
                'ì„œìš¸': ['ê°•ë‚¨êµ¬', 'ê°•ë™êµ¬', 'ê°•ë¶êµ¬', 'ê°•ì„œêµ¬', 'ê´€ì•…êµ¬', 'ê´‘ì§„êµ¬', 'êµ¬ë¡œêµ¬', 'ê¸ˆì²œêµ¬', 'ë…¸ì›êµ¬', 'ë„ë´‰êµ¬', 'ë™ëŒ€ë¬¸êµ¬', 'ë™ì‘êµ¬', 'ë§ˆí¬êµ¬', 'ì„œëŒ€ë¬¸êµ¬', 'ì„œì´ˆêµ¬', 'ì„±ë™êµ¬', 'ì„±ë¶êµ¬', 'ì†¡íŒŒêµ¬', 'ì–‘ì²œêµ¬', 'ì˜ë“±í¬êµ¬', 'ìš©ì‚°êµ¬', 'ì€í‰êµ¬', 'ì¢…ë¡œêµ¬', 'ì¤‘êµ¬', 'ì¤‘ë‘êµ¬'],
                'ë¶€ì‚°': ['ê°•ì„œêµ¬', 'ê¸ˆì •êµ¬', 'ê¸°ì¥êµ°', 'ë‚¨êµ¬', 'ë™êµ¬', 'ë™ë˜êµ¬', 'ë¶€ì‚°ì§„êµ¬', 'ë¶êµ¬', 'ì‚¬ìƒêµ¬', 'ì‚¬í•˜êµ¬', 'ì„œêµ¬', 'ìˆ˜ì˜êµ¬', 'ì—°ì œêµ¬', 'ì˜ë„êµ¬', 'ì¤‘êµ¬', 'í•´ìš´ëŒ€êµ¬'],
                'ëŒ€êµ¬': ['ë‚¨êµ¬', 'ë‹¬ì„œêµ¬', 'ë‹¬ì„±êµ°', 'ë™êµ¬', 'ë¶êµ¬', 'ì„œêµ¬', 'ìˆ˜ì„±êµ¬', 'ì¤‘êµ¬'],
                'ì¸ì²œ': ['ê°•í™”êµ°', 'ê³„ì–‘êµ¬', 'ë‚¨ë™êµ¬', 'ë™êµ¬', 'ë¯¸ì¶”í™€êµ¬', 'ë¶€í‰êµ¬', 'ì„œêµ¬', 'ì—°ìˆ˜êµ¬', 'ì˜¹ì§„êµ°', 'ì¤‘êµ¬'],
                'ê´‘ì£¼': ['ê´‘ì‚°êµ¬', 'ë‚¨êµ¬', 'ë™êµ¬', 'ë¶êµ¬', 'ì„œêµ¬'],
                'ëŒ€ì „': ['ëŒ€ë•êµ¬', 'ë™êµ¬', 'ì„œêµ¬', 'ìœ ì„±êµ¬', 'ì¤‘êµ¬'],
                'ìš¸ì‚°': ['ë‚¨êµ¬', 'ë™êµ¬', 'ë¶êµ¬', 'ìš¸ì£¼êµ°', 'ì¤‘êµ¬'],
                'ì„¸ì¢…': ['ì„¸ì¢…ì‹œ ì „ì²´'],
                'ê²½ê¸°': ['ê°€í‰êµ°', 'ê³ ì–‘ì‹œ', 'ê³¼ì²œì‹œ', 'ê´‘ëª…ì‹œ', 'ê´‘ì£¼ì‹œ', 'êµ¬ë¦¬ì‹œ', 'êµ°í¬ì‹œ', 'ê¹€í¬ì‹œ', 'ë‚¨ì–‘ì£¼ì‹œ', 'ë™ë‘ì²œì‹œ', 'ë¶€ì²œì‹œ', 'ì„±ë‚¨ì‹œ', 'ìˆ˜ì›ì‹œ', 'ì‹œí¥ì‹œ', 'ì•ˆì‚°ì‹œ', 'ì•ˆì„±ì‹œ', 'ì•ˆì–‘ì‹œ', 'ì–‘ì£¼ì‹œ', 'ì–‘í‰êµ°', 'ì—¬ì£¼ì‹œ', 'ì—°ì²œêµ°', 'ì˜¤ì‚°ì‹œ', 'ìš©ì¸ì‹œ', 'ì˜ì™•ì‹œ', 'ì˜ì •ë¶€ì‹œ', 'ì´ì²œì‹œ', 'íŒŒì£¼ì‹œ', 'í‰íƒì‹œ', 'í¬ì²œì‹œ', 'í•˜ë‚¨ì‹œ', 'í™”ì„±ì‹œ'],
                'ê°•ì›': ['ê°•ë¦‰ì‹œ', 'ê³ ì„±êµ°', 'ë™í•´ì‹œ', 'ì‚¼ì²™ì‹œ', 'ì†ì´ˆì‹œ', 'ì–‘êµ¬êµ°', 'ì–‘ì–‘êµ°', 'ì˜ì›”êµ°', 'ì›ì£¼ì‹œ', 'ì¸ì œêµ°', 'ì •ì„ êµ°', 'ì² ì›êµ°', 'ì¶˜ì²œì‹œ', 'íƒœë°±ì‹œ', 'í‰ì°½êµ°', 'í™ì²œêµ°', 'í™”ì²œêµ°', 'íš¡ì„±êµ°'],
                'ì¶©ë¶': ['ê´´ì‚°êµ°', 'ë‹¨ì–‘êµ°', 'ë³´ì€êµ°', 'ì˜ë™êµ°', 'ì˜¥ì²œêµ°', 'ìŒì„±êµ°', 'ì œì²œì‹œ', 'ì¦í‰êµ°', 'ì§„ì²œêµ°', 'ì²­ì£¼ì‹œ', 'ì¶©ì£¼ì‹œ'],
                'ì¶©ë‚¨': ['ê³„ë£¡ì‹œ', 'ê³µì£¼ì‹œ', 'ê¸ˆì‚°êµ°', 'ë…¼ì‚°ì‹œ', 'ë‹¹ì§„ì‹œ', 'ë³´ë ¹ì‹œ', 'ë¶€ì—¬êµ°', 'ì„œì‚°ì‹œ', 'ì„œì²œêµ°', 'ì•„ì‚°ì‹œ', 'ì˜ˆì‚°êµ°', 'ì²œì•ˆì‹œ', 'ì²­ì–‘êµ°', 'íƒœì•ˆêµ°', 'í™ì„±êµ°'],
                'ì „ë¶': ['ê³ ì°½êµ°', 'êµ°ì‚°ì‹œ', 'ê¹€ì œì‹œ', 'ë‚¨ì›ì‹œ', 'ë¬´ì£¼êµ°', 'ë¶€ì•ˆêµ°', 'ìˆœì°½êµ°', 'ì™„ì£¼êµ°', 'ìµì‚°ì‹œ', 'ì„ì‹¤êµ°', 'ì¥ìˆ˜êµ°', 'ì „ì£¼ì‹œ', 'ì •ìì‹œ', 'ì§„ì•ˆêµ°'],
                'ì „ë‚¨': ['ê°•ì§„êµ°', 'ê³ í¥êµ°', 'ê³¡ì„±êµ°', 'ê´‘ì–‘ì‹œ', 'êµ¬ë¡€êµ°', 'ë‚˜ì£¼ì‹œ', 'ë‹´ì–‘êµ°', 'ëª©í¬ì‹œ', 'ë¬´ì•ˆêµ°', 'ë³´ì„±êµ°', 'ìˆœì²œì‹œ', 'ì‹ ì•ˆêµ°', 'ì—¬ìˆ˜ì‹œ', 'ì˜ê´‘êµ°', 'ì˜ì•”êµ°', 'ì™„ë„êµ°', 'ì¥ì„±êµ°', 'ì¥í¥êµ°', 'ì§„ë„êµ°', 'í•¨í‰êµ°', 'í•´ë‚¨êµ°', 'í™”ìˆœêµ°'],
                'ê²½ë¶': ['ê²½ì‚°ì‹œ', 'ê²½ì£¼ì‹œ', 'ê³ ë ¹êµ°', 'êµ¬ë¯¸ì‹œ', 'êµ°ìœ„êµ°', 'ê¹€ì²œì‹œ', 'ë¬¸ê²½ì‹œ', 'ë´‰í™”êµ°', 'ìƒì£¼ì‹œ', 'ì„±ì£¼êµ°', 'ì•ˆë™ì‹œ', 'ì˜ë•êµ°', 'ì˜ì–‘êµ°', 'ì˜ì£¼ì‹œ', 'ì˜ì²œì‹œ', 'ì˜ˆì²œêµ°', 'ìš¸ë¦‰êµ°', 'ìš¸ì§„êµ°', 'ì˜ì„±êµ°', 'ì²­ë„êµ°', 'ì²­ì†¡êµ°', 'ì¹ ê³¡êµ°', 'í¬í•­ì‹œ'],
                'ê²½ë‚¨': ['ê±°ì œì‹œ', 'ê±°ì°½êµ°', 'ê³ ì„±êµ°', 'ê¹€í•´ì‹œ', 'ë‚¨í•´êµ°', 'ë°€ì–‘ì‹œ', 'ì‚¬ì²œì‹œ', 'ì‚°ì²­êµ°', 'ì–‘ì‚°ì‹œ', 'ì˜ë ¹êµ°', 'ì§„ì£¼ì‹œ', 'ì°½ë…•êµ°', 'ì°½ì›ì‹œ', 'í†µì˜ì‹œ', 'í•˜ë™êµ°', 'í•¨ì•ˆêµ°', 'í•¨ì–‘êµ°', 'í•©ì²œêµ°'],
                'ì œì£¼': ['ì„œê·€í¬ì‹œ', 'ì œì£¼ì‹œ']
            },

            init() {
                this.elements = {
                    messages: document.getElementById('messagesArea'),
                    inputArea: document.getElementById('inputArea'),
                    progressFill: document.getElementById('progressFill'),
                    progressText: document.getElementById('progressText'),
                    resetBtn: document.getElementById('resetBtn'),
                    resultModal: document.getElementById('resultModal'),
                    modalBody: document.getElementById('modalBody'),
                    closeBtn: document.getElementById('closeBtn'),
                    modalOverlay: document.getElementById('modalOverlay')
                };
                this.elements.resetBtn.onclick = () => this.reset();
                this.elements.closeBtn.onclick = () => this.closeModal();
                this.elements.modalOverlay.onclick = () => this.closeModal();
                this.showQuestion(0);
            },

            reset() {
                this.state = { step: 0, answers: {}, currentPage: 1, allServices: [], totalCount: 0 };
                this.elements.messages.innerHTML = '';
                this.elements.progressFill.style.width = '0%';
                this.elements.progressText.textContent = 'ì‹œì‘í•˜ê¸°';
                this.showQuestion(0);
            },

            getNextQuestion(idx) {
                for (let i = idx + 1; i < this.questions.length; i++) {
                    const q = this.questions[i];
                    if (!q.condition) return i;
                    if (Object.entries(q.condition).every(([k, v]) => this.state.answers[k] === v)) return i;
                }
                return -1;
            },

            showQuestion(idx) {
                const q = this.questions[idx];
                if (!q) return this.submitAnswers();
                this.state.step = idx;
                if (q.progressText) {
                    const [c, t] = q.progressText.match(/\d+/g);
                    this.elements.progressFill.style.width = (c / t * 100) + '%';
                    this.elements.progressText.textContent = q.progressText;
                }
                this.showTyping();
                setTimeout(() => {
                    this.hideTyping();
                    this.addBotMessage(q.message);
                    this.renderInput(q);
                }, 600);
            },

            showTyping() {
                const d = document.createElement('div');
                d.className = 'message bot typing-msg';
                d.innerHTML = '<div class="message-avatar"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg></div><div class="message-bubble"><div class="typing-dots"><span></span><span></span><span></span></div></div>';
                this.elements.messages.appendChild(d);
                this.scroll();
            },

            hideTyping() {
                const t = this.elements.messages.querySelector('.typing-msg');
                if (t) t.remove();
            },

            addBotMessage(txt) {
                const d = document.createElement('div');
                d.className = 'message bot';
                d.innerHTML = '<div class="message-avatar"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg></div><div class="message-bubble">' + txt.replace(/\n/g, '<br>') + '</div>';
                this.elements.messages.appendChild(d);
                this.scroll();
            },

            addUserMessage(txt) {
                const d = document.createElement('div');
                d.className = 'message user';
                d.innerHTML = '<div class="message-bubble">' + txt + '</div>';
                this.elements.messages.appendChild(d);
                this.scroll();
            },

            scroll() { this.elements.messages.scrollTop = this.elements.messages.scrollHeight; },

            renderInput(q) {
                this.elements.inputArea.innerHTML = '';
                if (q.type === 'single') this.renderSingle(q);
                else if (q.type === 'multi') this.renderMulti(q);
                else if (q.type === 'region') this.renderRegion(q);
                else if (q.type === 'birthGender') this.renderBirthGender(q);
            },

            renderSingle(q) {
                const c = document.createElement('div');
                c.className = 'options-grid ' + (q.gridClass || '');
                q.options.forEach(o => {
                    const b = document.createElement('button');
                    b.className = 'option-btn';
                    b.innerHTML = o.sub ? o.label + '<span class="sub-text">' + o.sub + '</span>' : o.label;
                    b.onclick = () => {
                        this.addUserMessage(o.label);
                        this.state.answers[q.id] = o.value;
                        this.next();
                    };
                    c.appendChild(b);
                });
                this.elements.inputArea.appendChild(c);
            },

            renderMulti(q) {
                const c = document.createElement('div');
                c.className = 'options-grid ' + (q.gridClass || '');
                const sel = new Set();
                q.options.forEach(o => {
                    const b = document.createElement('button');
                    b.className = 'option-btn multi';
                    b.textContent = o.label;
                    b.dataset.value = o.value;
                    b.onclick = () => {
                        if (o.value === 'JA9999') {
                            sel.clear();
                            c.querySelectorAll('.option-btn').forEach(x => x.classList.remove('selected'));
                            b.classList.add('selected');
                            sel.add(o.value);
                        } else {
                            const none = c.querySelector('[data-value="JA9999"]');
                            if (none) { none.classList.remove('selected'); sel.delete('JA9999'); }
                            if (sel.has(o.value)) { sel.delete(o.value); b.classList.remove('selected'); }
                            else { sel.add(o.value); b.classList.add('selected'); }
                        }
                        conf.disabled = sel.size === 0;
                    };
                    c.appendChild(b);
                });
                const conf = document.createElement('button');
                conf.className = 'confirm-btn';
                conf.textContent = 'ì„ íƒ ì™„ë£Œ';
                conf.disabled = true;
                conf.onclick = () => {
                    const labels = [...sel].map(v => q.options.find(x => x.value === v)?.label || v);
                    this.addUserMessage(labels.join(', '));
                    this.state.answers[q.id] = [...sel];
                    this.next();
                };
                this.elements.inputArea.appendChild(c);
                this.elements.inputArea.appendChild(conf);
            },

            renderRegion(q) {
                const c = document.createElement('div');
                c.className = 'select-wrap';
                const s1 = document.createElement('select');
                s1.className = 'custom-select';
                s1.innerHTML = '<option value="">ì‹œ/ë„ ì„ íƒ</option>' + Object.keys(this.regions).map(r => '<option value="' + r + '">' + r + '</option>').join('');
                const s2 = document.createElement('select');
                s2.className = 'custom-select';
                s2.innerHTML = '<option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>';
                s2.disabled = true;
                s1.onchange = () => {
                    s2.innerHTML = '<option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>';
                    if (s1.value && this.regions[s1.value]) {
                        s2.disabled = false;
                        s2.innerHTML += this.regions[s1.value].map(g => '<option value="' + g + '">' + g + '</option>').join('');
                    } else s2.disabled = true;
                    conf.disabled = true;
                };
                s2.onchange = () => { conf.disabled = !s2.value; };
                const conf = document.createElement('button');
                conf.className = 'confirm-btn';
                conf.textContent = 'ì„ íƒ ì™„ë£Œ';
                conf.disabled = true;
                conf.onclick = () => {
                    this.addUserMessage(s1.value + ' ' + s2.value);
                    this.state.answers[q.id] = { sido: s1.value, gugun: s2.value };
                    this.next();
                };
                c.appendChild(s1);
                c.appendChild(s2);
                this.elements.inputArea.appendChild(c);
                this.elements.inputArea.appendChild(conf);
            },

            renderBirthGender(q) {
                const c = document.createElement('div');
                c.className = 'birth-wrap';
                c.innerHTML = '<div class="birth-section"><div class="birth-label">ìƒë…„ì›”ì¼</div><div class="birth-row"><div class="birth-input-wrap year"><input type="number" class="birth-input" id="yearInput" placeholder="1990" min="1900" max="2025"></div><span class="birth-suffix">ë…„</span><div class="birth-input-wrap"><input type="number" class="birth-input" id="monthInput" placeholder="1" min="1" max="12"></div><span class="birth-suffix">ì›”</span><div class="birth-input-wrap"><input type="number" class="birth-input" id="dayInput" placeholder="1" min="1" max="31"></div><span class="birth-suffix">ì¼</span></div></div><div class="birth-section"><div class="birth-label">ì„±ë³„</div><div class="gender-btns" id="genderBtns"><button class="option-btn" data-g="M">ë‚¨ì„±</button><button class="option-btn" data-g="F">ì—¬ì„±</button></div></div>';
                this.elements.inputArea.appendChild(c);
                const conf = document.createElement('button');
                conf.className = 'confirm-btn';
                conf.textContent = 'ì„ íƒ ì™„ë£Œ';
                conf.disabled = true;
                this.elements.inputArea.appendChild(conf);

                const yI = document.getElementById('yearInput');
                const mI = document.getElementById('monthInput');
                const dI = document.getElementById('dayInput');
                const gB = document.getElementById('genderBtns');
                let gender = '';
                
                const check = () => {
                    const y = yI.value, m = mI.value, d = dI.value;
                    conf.disabled = !(y && y.length === 4 && m && d && gender);
                };
                [yI, mI, dI].forEach(i => i.oninput = check);
                gB.querySelectorAll('.option-btn').forEach(b => {
                    b.onclick = () => {
                        gB.querySelectorAll('.option-btn').forEach(x => x.classList.remove('selected'));
                        b.classList.add('selected');
                        gender = b.dataset.g;
                        check();
                    };
                });
                conf.onclick = () => {
                    this.addUserMessage(yI.value + 'ë…„ ' + mI.value.padStart(2, '0') + 'ì›” ' + dI.value.padStart(2, '0') + 'ì¼, ' + (gender === 'M' ? 'ë‚¨ì„±' : 'ì—¬ì„±'));
                    this.state.answers[q.id] = { year: yI.value, month: mI.value.padStart(2, '0'), day: dI.value.padStart(2, '0'), gender };
                    this.next();
                };
            },

            next() {
                this.elements.inputArea.innerHTML = '';
                const n = this.getNextQuestion(this.state.step);
                if (n === -1) this.submitAnswers();
                else setTimeout(() => this.showQuestion(n), 300);
            },

            async submitAnswers() {
                this.elements.progressFill.style.width = '100%';
                this.elements.progressText.textContent = 'ê²€ìƒ‰ ì¤‘...';
                this.showTyping();

                try {
                    console.log('Submitting:', this.state.answers);
                    
                    const res = await fetch(CONFIG.API_PROXY_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.state.answers)
                    });

                    if (!res.ok) throw new Error('API ì˜¤ë¥˜: ' + res.status);
                    
                    const data = await res.json();
                    console.log('Response:', data);

                    if (data.error) throw new Error(data.message || 'API ì˜¤ë¥˜');

                    this.state.allServices = data.services || [];
                    this.state.totalCount = data.totalCount || 0;
                    this.state.currentPage = 1;

                    this.hideTyping();
                    this.addBotMessage('ğŸ‰ ê²€ìƒ‰ì´ ì™„ë£Œë˜ì—ˆì–´ìš”!\n\nì´ <strong>' + this.state.totalCount.toLocaleString() + 'ê°œ</strong>ì˜ ë§ì¶¤ ì§€ì›ê¸ˆì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.\n\nâ­ ì¶”ì²œ í‘œì‹œëŠ” ì…ë ¥í•˜ì‹  ì¡°ê±´ì— ì í•©í•œ ì§€ì›ê¸ˆì´ì—ìš”!');
                    setTimeout(() => this.renderModal(), 500);
                } catch (e) {
                    console.error('Error:', e);
                    this.hideTyping();
                    this.addBotMessage('ì£„ì†¡í•©ë‹ˆë‹¤. ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ' + e.message + '\n\nì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            },

            renderModal() {
                const { allServices, totalCount, currentPage } = this.state;
                const perPage = CONFIG.ITEMS_PER_PAGE;
                const totalPages = Math.ceil(allServices.length / perPage);
                const start = (currentPage - 1) * perPage;
                const end = start + perPage;
                const pageServices = allServices.slice(start, end);

                let html = '';
                if (totalCount === 0 || allServices.length === 0) {
                    html = '<div class="no-result"><div class="no-result-icon">ğŸ”</div><div class="no-result-title">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div><div class="no-result-desc">ì„ íƒí•˜ì‹  ì¡°ê±´ì— ë§ëŠ” ì§€ì›ê¸ˆì´ ì—†ìŠµë‹ˆë‹¤.</div></div>';
                } else {
                    html = '<div class="result-stats"><div class="stat-card highlight"><div class="stat-number">' + totalCount.toLocaleString() + '</div><div class="stat-label">ê²€ìƒ‰ëœ ì§€ì›ê¸ˆ</div></div><div class="stat-card"><div class="stat-number">' + (start + 1) + '-' + Math.min(end, allServices.length) + '</div><div class="stat-label">/ ' + allServices.length + 'ê°œ í‘œì‹œ</div></div></div>';
                    html += '<div class="result-list">';
                    pageServices.forEach((s, i) => {
                        const gIdx = start + i;
                        const name = s.servNm || 'ì •ë³´ ì—†ìŒ';
                        const desc = s.servDgst || s.tgtrDtlCn || '';
                        const org = s.jurMnofNm || '';
                        const category = s.svcfldNm || 'ì§€ì›ê¸ˆ';
                        const servId = s.servId || '';
                        const detailLink = s.servDtlLink || '';
                        const isRec = s._matchScore > 0 && gIdx < 5;

                        // ìì„¸íˆ ë³´ê¸° ë§í¬ ê²°ì •
                        let link = '';
                        if (detailLink && detailLink.startsWith('http')) {
                            link = detailLink;
                        } else if (servId) {
                            link = 'https://www.gov.kr/portal/rcvfvrSvc/dtlEx/' + servId;
                        }

                        html += '<div class="result-card' + (isRec ? ' recommended' : '') + '">';
                        html += '<span class="result-badge">' + category + '</span>';
                        html += '<h4 class="result-title">' + name + '</h4>';
                        if (org) html += '<p class="result-org">' + org + '</p>';
                        if (desc) html += '<p class="result-desc">' + desc + '</p>';
                        if (link) {
                            html += '<a href="' + link + '" target="_blank" rel="noopener" class="result-link">ìì„¸íˆ ë³´ê¸° <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg></a>';
                        }
                        html += '</div>';
                    });
                    html += '</div>';

                    if (totalPages > 1) {
                        html += '<div class="pagination">';
                        html += '<button class="page-btn" data-p="prev"' + (currentPage === 1 ? ' disabled' : '') + '><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>';
                        html += '<div class="page-numbers">';
                        let sp = Math.max(1, currentPage - 2);
                        let ep = Math.min(totalPages, sp + 4);
                        if (ep - sp < 4) sp = Math.max(1, ep - 4);
                        for (let i = sp; i <= ep; i++) {
                            html += '<button class="page-btn' + (i === currentPage ? ' active' : '') + '" data-p="' + i + '">' + i + '</button>';
                        }
                        html += '</div>';
                        html += '<button class="page-btn" data-p="next"' + (currentPage === totalPages ? ' disabled' : '') + '><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></button>';
                        html += '</div>';
                    }
                }

                this.elements.modalBody.innerHTML = html;
                
                // í˜ì´ì§€ë„¤ì´ì…˜ ì´ë²¤íŠ¸
                const pag = this.elements.modalBody.querySelector('.pagination');
                if (pag) {
                    pag.onclick = (e) => {
                        const btn = e.target.closest('.page-btn');
                        if (!btn || btn.disabled) return;
                        const p = btn.dataset.p;
                        if (p === 'prev') this.state.currentPage = Math.max(1, this.state.currentPage - 1);
                        else if (p === 'next') this.state.currentPage = Math.min(totalPages, this.state.currentPage + 1);
                        else this.state.currentPage = parseInt(p);
                        this.renderModal();
                        this.elements.modalBody.scrollTop = 0;
                    };
                }

                this.elements.resultModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            },

            closeModal() {
                this.elements.resultModal.classList.remove('active');
                document.body.style.overflow = '';
            }
        };

        document.addEventListener('DOMContentLoaded', () => Chatbot.init());
    })();
    </script>
</body>
</html>
